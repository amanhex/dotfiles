#!/bin/bash

while true; do
  # Get the current RAM usage
  total_mem=$(free | awk '/Mem/ {print $2}')
  used_mem=$(free | awk '/Mem/ {print $3}')
  ram_usage=$(awk "BEGIN {print ($used_mem / $total_mem) * 100}")

  # Check if RAM usage is over 70%
  if [ $(awk "BEGIN {print ($ram_usage > 70)}") -eq 1 ]; then
    # Ask the user whether to kill the program using wofi
    choice=$(echo -e "Kill Program \n Do Nothing" | wofi --dmenu --prompt "High RAM Usage" --lines 2 --width 400)

    if [ "$choice" == "Kill Program" ]; then
      # Get the process name with the highest memory usage
      process_name=$(ps aux --sort=-%mem | awk 'NR==2 {print $11}')

      # Kill the process by name using pkill with -f option
      pkill -f "$process_name"
      notify-send "Process Killed" "Process '$process_name' was killed due to high RAM usage."
    fi
  fi

  # Sleep for a while before checking again (you can adjust this time interval)
  sleep 30
done

